---
title: "Secure Password Reset"
description: ""
lead: "Chall 1"
draft: false
images: []
menu:
  docs:
    parent: "cryptographic-failures"
toc: true
authors: Prajyot Chemburkar
---


{{< tabs tabTotal="2">}}
{{% tab tabName="Challenge" %}}

- In this challenge, you are tasked with reviewing a code snippet that implements a password reset functionality using UUID (Universally Unique Identifier). Your goal is to identify any potential vulnerabilities in the code that could compromise the security of the password reset process.

controller/user_controller.go
````go {linenos=true,anchorlinenos=true}
package controller

import (
	"fmt"
	"net/http"
	"service"
	"middleware"
	"schema"
	"github.com/gin-gonic/gin"
)

type UserController struct {
	userService *service.UserService;
}

// GenerateAndSendPasswordResetToken
// @Description Generate the password reset token and email it to the user.
// @Router /user/password/reset [post]
func (uc *UserController) GenerateAndSendPasswordResetToken(ctx *gin.Context) {
	req := &schema.UserPasswordResetGenerateRequest{}
	if handler.BindAndCheck(ctx, req) {
		return
	}
	req.userId = middleware.GetUserIdFromContext(ctx)
	token := uc.userService.GenerateToken(req.userId)
	uc.userService.sendMail("Click this link to reset your password: https://example.com/user/password/reset?token=" + token, req.userId)
}

// ResetPassword
// @Description Reset users password
// @Router /user/password/reset [get]
func (uc *UserController) ResetPassword(ctx *gin.Context) {
	req := &schema.UserPasswordResetRequest{}
	if handler.BindAndCheck(ctx, req) {
		return
	}
	req.userId = middleware.GerUserIdFromContext(ctx)
	status := uc.ResetPassword(req.token, req.userId)
	if staus {
		return "Password reset successsfully"
	} else {
		return "Incorrect token"
	}
}
````

router/api_router.go
````go {linenos=true,anchorlinenos=true}
package router

import (
	"controller"
	"github.com/gin-gonic/gin"
)

type APIRouter struct {
	userController *controller.UserController
}

func (a *APIRouter) RegisterMustUnauthAPIRouter(r *gin.RouterGroup) {
	// reset password route
	r.GET("/password/reset", a.userController.ResetPassword)
	r.POST("/password/reset", a.userController.GenerateAndSendPasswordResetToken)
}
````

service/user_service.go
````go {linenos=true,anchorlinenos=true}
package service

import (
	"smtp"
	"db"
	"middleware"
	"github.com/google/uuid"
)

type AuthService interface {
	GenerateToken()
	ResetPassword()
	SendMail()
}

type UserService struct {
	authService authService
	mailService *smtp.mailService
}

// GenerateToken
// @Description Generates unique UUID token and sets it for the specified user.
func GenerateToken(userId string) string {
	uid, _ := uuid.NewUUID()
	db.setPasswordResetToken(userId, uid)
	return uid.String()
}

// ResetPassword
// @Description Reset password for specified user
func ResetPassword(token string, userId string) bool {
	return db.resetPasswordViaToken(token, userId)
}

// SendMail
// @Description Send email
func SendMail(message string, userId string) {
	email :=  middleware.GetEmailFromUserId(userId)
	mailService.send_mail(message, email)
}
````
{{% /tab %}}
{{% tab tabName="Solution" %}}

````js {linenos=table,hl_lines=[3,"5-7"],anchorlinenos=true}
Stay tuned for updates on the solution !!
````
{{% /tab %}}
{{< /tabs >}}

## References

- [https://cheatsheetseries.owasp.org/](https://cheatsheetseries.owasp.org/) 
- [https://owasp.org/Top10/A02_2021-Cryptographic_Failures/](https://owasp.org/Top10/A02_2021-Cryptographic_Failures/) 
- [https://docs.microsoft.com/en-us/dotnet/standard/security/](https://docs.microsoft.com/en-us/dotnet/standard/security/)
- [https://github.com/guardrailsio/awesome-dotnet-security](https://github.com/guardrailsio/awesome-dotnet-security)
- [https://owasp.org/www-project-top-ten/2017/Top_10.html](https://owasp.org/www-project-top-ten/2017/Top_10.html)
