---
title: "Login logs"
description: ""
lead: "Chall 1"
draft: false
images: []
menu:
  docs:
    parent: "improper-logging"
toc: true
authors: Mukund Kedia
---


{{< tabs tabTotal="2">}}
{{% tab tabName="Challenge" %}}

- The code is meant to handle user authentication, but unfortunately, it contains a vulnerability. A bonus vulnerability is also present, can you spot that as well?

````csharp {linenos=true,anchorlinenos=true}
using System;
using System.Data;
using System.Data.SqlClient;
using Microsoft.AspNetCore.Mvc;

public class Clients
{
    public string email { get; set; }
    public string password { get; set; }
}

[HttpPost]
public IActionResult LoginUser([FromBody] Clients model)
{
    var email = model.email;
    var password = model.password;

    string constring = "Data Source=localhost\\sqlexpress;Initial Catalog=testdb;Integrated Security=True";

    var log = "User " + email + " logged in.";

    using (SqlConnection con = new SqlConnection(constring))
    {
        con.Open();
        string query = "INSERT INTO logs (log) values (@log)";
        SqlParameter logParam = new SqlParameter("@log", SqlDbType.NVarChar, 50);
        logParam.Value = log;

        using (SqlCommand cmd = new SqlCommand(query, con))
        {
            SqlDataReader reader = cmd.ExecuteReader();
        }
    }

    using (SqlConnection con = new SqlConnection(constring))
    {
        con.Open();
        string query = "SELECT * FROM clients WHERE email=@email AND password=@password";
        SqlParameter emailParam = new SqlParameter("@email", SqlDbType.NVarChar, 50);
        emailParam.Value = email;
        SqlParameter passwordParam = new SqlParameter("@password", SqlDbType.NVarChar, 50);
        passwordParam.Value = password;

        using (SqlCommand cmd = new SqlCommand(query, con))
        {
            SqlDataReader reader = cmd.ExecuteReader();
            if (reader.HasRows)
            {
                return Content("Login successful");
            }
            else
            {
                return Content("Login unsuccessful");
            }
        }
    }
}
````
{{% /tab %}}
{{% tab tabName="Solution" %}}

````csharp {linenos=table,hl_lines=[3,"5-7"],anchorlinenos=true}
Stay tuned for updates on the solution !!
````
{{% /tab %}}
{{< /tabs >}}

## References

- [https://cheatsheetseries.owasp.org/](https://cheatsheetseries.owasp.org/)
- [https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/](https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/)
- [https://docs.microsoft.com/en-us/dotnet/standard/security/](https://docs.microsoft.com/en-us/dotnet/standard/security/)
- [https://github.com/guardrailsio/awesome-dotnet-security](https://github.com/guardrailsio/awesome-dotnet-security)
- [https://owasp.org/www-project-top-ten/2017/Top_10.html](https://owasp.org/www-project-top-ten/2017/Top_10.html)
